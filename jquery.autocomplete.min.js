/*
 * jQuery Autocomplete plugin 1.2.2
 *
 * Copyright (c) 2009 Jörn Zaefferer
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * With small modifications by Alfonso Gómez-Arzola and me (disc).
 * See changelog for details.
 *
 */
(function(c){c.fn.extend({autocomplete:function(a,b){var r="string"==typeof a;b=c.extend({},c.Autocompleter.defaults,{url:r?a:null,data:r?null:a,delay:r?c.Autocompleter.defaults.delay:10,max:b&&!b.scroll?10:150},b);b.highlight=b.highlight||function(a){return a};b.formatMatch=b.formatMatch||b.formatItem;return this.each(function(){new c.Autocompleter(this,b)})},result:function(a){return this.bind("result",a)},search:function(a){return this.trigger("search",[a])},flushCache:function(){return this.trigger("flushCache")},
setOptions:function(a){return this.trigger("setOptions",[a])},unautocomplete:function(){return this.trigger("unautocomplete")}});c.Autocompleter=function(a,b){function r(){var w=n.selected();if(!w)return!1;var d=w.result;l=d;if(b.multiple){var e=q(f.val());if(1<e.length){var g=b.multipleSeparator.length,j=c(a).selection().start,h,k=0;c.each(e,function(a,b){k+=b.length;if(j<=k)return h=a,!1;k+=g});e[h]=d;d=e.join(b.multipleSeparator)}d+=b.multipleSeparator}f.val(d);p();f.trigger("result",[w.data,w.value]);
return!0}function m(a,c){if(u==g.DEL)n.hide();else{var j=f.val();if(c||j!=l)l=j,j=k(j),j.length>=b.minChars?(f.addClass(b.loadingClass),b.matchCase||(j=j.toLowerCase()),e(j,d,p)):(f.removeClass(b.loadingClass),n.hide())}}function q(a){return!a?[""]:!b.multiple?[c.trim(a)]:c.map(a.split(b.multipleSeparator),function(b){return c.trim(a).length?c.trim(b):null})}function k(d){if(!b.multiple)return d;var j=q(d);if(1==j.length)return j[0];j=c(a).selection().start;j=j==d.length?q(d):q(d.replace(d.substring(j),
""));return j[j.length-1]}function p(){n.visible();n.hide();clearTimeout(h);f.removeClass(b.loadingClass);b.mustMatch&&f.search(function(a){a||(b.multiple?(a=q(f.val()).slice(0,-1),f.val(a.join(b.multipleSeparator)+(a.length?b.multipleSeparator:""))):(f.val(""),f.trigger("result",null)))})}function d(d,j){if(j&&j.length&&v){f.removeClass(b.loadingClass);n.display(j,d);var e=j[0].value;b.autoFill&&(k(f.val()).toLowerCase()==d.toLowerCase()&&u!=g.BACKSPACE)&&(f.val(f.val()+e.substring(k(l).length)),
c(a).selection(l.length,l.length+e.length));n.show()}else p()}function e(d,e,g){b.matchCase||(d=d.toLowerCase());var f=j.load(d);if(f&&f.length)e(d,f);else if("string"==typeof b.url&&0<b.url.length){var h={timestamp:+new Date};c.each(b.extraParams,function(a,b){h[a]="function"==typeof b?b():b});c.ajax({mode:"abort",port:"autocomplete"+a.name,dataType:b.dataType,url:b.url,data:c.extend({q:k(d),limit:b.max},h),success:function(a){var f;if(!(f=b.parse&&b.parse(a))){f=[];a=a.split("\n");for(var g=0;g<
a.length;g++){var h=c.trim(a[g]);h&&(h=h.split("|"),f[f.length]={data:h,value:h[0],result:b.formatResult&&b.formatResult(h,h[0])||h[0]})}}j.add(d,f);e(d,f)}})}else n.emptyList(),null!=t?t():g(d)}var g={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},t=null;null!=b.failure&&"function"==typeof b.failure&&(t=b.failure);var f=c(a).attr("autocomplete","off").addClass(b.inputClass),h,l="",j=c.Autocompleter.Cache(b),v=0,u,s={mouseDownOnSelect:!1},n=c.Autocompleter.Select(b,
a,r,s),x;-1!=navigator.userAgent.indexOf("Opera")&&c(a.form).bind("submit.autocomplete",function(){if(x)return x=!1});f.bind((-1!=navigator.userAgent.indexOf("Opera")?"keypress":"keydown")+".autocomplete",function(a){v=1;u=a.keyCode;switch(a.keyCode){case g.UP:n.visible()?(a.preventDefault(),n.prev()):m(0,!0);break;case g.DOWN:n.visible()?(a.preventDefault(),n.next()):m(0,!0);break;case g.PAGEUP:n.visible()?(a.preventDefault(),n.pageUp()):m(0,!0);break;case g.PAGEDOWN:n.visible()?(a.preventDefault(),
n.pageDown()):m(0,!0);break;case b.multiple&&","==c.trim(b.multipleSeparator)&&g.COMMA:case g.TAB:case g.RETURN:if(r())return a.preventDefault(),x=!0,!1;break;case g.ESC:n.hide();break;default:clearTimeout(h),h=setTimeout(m,b.delay)}}).focus(function(){v++}).blur(function(){v=0;s.mouseDownOnSelect||(clearTimeout(h),h=setTimeout(p,200))}).click(function(){b.clickFire?n.visible()||m(0,!0):1<v++&&!n.visible()&&m(0,!0)}).bind("search",function(){function a(d,j){var e;if(j&&j.length)for(var c=0;c<j.length;c++)if(j[c].result.toLowerCase()==
d.toLowerCase()){e=j[c];break}"function"==typeof b?b(e):f.trigger("result",e&&[e.data,e.value])}var b=1<arguments.length?arguments[1]:null;c.each(q(f.val()),function(b,d){e(d,a,a)})}).bind("flushCache",function(){j.flush()}).bind("setOptions",function(a,d){c.extend(!0,b,d);"data"in d&&j.populate()}).bind("unautocomplete",function(){n.unbind();f.unbind();c(a.form).unbind(".autocomplete")})};c.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,
delay:400,matchCase:!1,matchSubset:!0,matchContains:!1,cacheLength:100,max:1E3,mustMatch:!1,extraParams:{},selectFirst:!0,formatItem:function(a){return a[0]},formatMatch:null,autoFill:!1,width:0,multiple:!1,multipleSeparator:" ",inputFocus:!0,clickFire:!1,highlight:function(a,b){return a.replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:!0,scrollHeight:180,scrollJumpPosition:!0};c.Autocompleter.Cache=
function(a){function b(b,e){a.matchCase||(b=b.toLowerCase());var c=b.indexOf(e);"word"==a.matchContains&&(c=b.toLowerCase().search("\\b"+e.toLowerCase()));return-1==c?!1:0==c||a.matchContains}function r(b,c){p>a.cacheLength&&q();k[b]||p++;k[b]=c}function m(){if(!a.data)return!1;var b={},e=0;a.url||(a.cacheLength=1);b[""]=[];for(var g=0,k=a.data.length;g<k;g++){var f=a.data[g],f="string"==typeof f?[f]:f,h=a.formatMatch(f,g+1,a.data.length);if(!("undefined"===typeof h||!1===h)){var l=h.charAt(0).toLowerCase();
b[l]||(b[l]=[]);f={value:h,data:f,result:a.formatResult&&a.formatResult(f)||h};b[l].push(f);e++<a.max&&b[""].push(f)}}c.each(b,function(b,d){a.cacheLength++;r(b,d)})}function q(){k={};p=0}var k={},p=0;setTimeout(m,25);return{flush:q,add:r,populate:m,load:function(d){if(!a.cacheLength||!p)return null;if(!a.url&&a.matchContains){var e=[],g;for(g in k)if(0<g.length){var m=k[g];c.each(m,function(a,c){b(c.value,d)&&e.push(c)})}return e}if(k[d])return k[d];if(a.matchSubset)for(g=d.length-1;g>=a.minChars;g--)if(m=
k[d.substr(0,g)])return e=[],c.each(m,function(a,c){b(c.value,d)&&(e[e.length]=c)}),e;return null}}};c.Autocompleter.Select=function(a,b,r,m){function q(a){for(a=a.target;a&&"LI"!=a.tagName;)a=a.parentNode;return!a?[]:a}function k(b){d.slice(e,e+1).removeClass(p.ACTIVE);if(a.scrollJumpPosition||!a.scrollJumpPosition&&!(0>b&&0==e||0<b&&e==d.size()-1))e+=b,0>e?e=d.size()-1:e>=d.size()&&(e=0);b=d.slice(e,e+1).addClass(p.ACTIVE);if(a.scroll){var c=0;d.slice(0,e).each(function(){c+=this.offsetHeight});
c+b[0].offsetHeight-l.scrollTop()>l[0].clientHeight?l.scrollTop(c+b[0].offsetHeight-l.innerHeight()):c<l.scrollTop()&&l.scrollTop(c)}}var p={ACTIVE:"ac_over"},d,e=-1,g,t="",f=!0,h,l;return{display:function(j,k){f&&(h=c("<div/>").hide().addClass(a.resultsClass).css("position","absolute").appendTo(document.body).hover(function(){c(this).is(":visible")&&b.focus();m.mouseDownOnSelect=!1}),l=c("<ul/>").appendTo(h).mouseover(function(a){q(a).nodeName&&"LI"==q(a).nodeName.toUpperCase()&&(e=c("li",l).removeClass(p.ACTIVE).index(q(a)),
c(q(a)).addClass(p.ACTIVE))}).click(function(d){c(q(d)).addClass(p.ACTIVE);r();a.inputFocus&&b.focus();return!1}).mousedown(function(){m.mouseDownOnSelect=!0}).mouseup(function(){m.mouseDownOnSelect=!1}),0<a.width&&h.css("width",a.width),f=!1);g=j;t=k;l.empty();for(var u=a.max&&a.max<g.length?a.max:g.length,s=0;s<u;s++)if(g[s]){var n=a.formatItem(g[s].data,s+1,u,g[s].value,t);!1!==n&&(n=c("<li/>").html(a.highlight(n,t)).addClass(0==s%2?"ac_even":"ac_odd").appendTo(l)[0],c.data(n,"ac_data",g[s]))}d=
l.find("li");a.selectFirst&&(d.slice(0,1).addClass(p.ACTIVE),e=0);c.fn.bgiframe&&l.bgiframe()},next:function(){k(1)},prev:function(){k(-1)},pageUp:function(){0!=e&&0>e-8?k(-e):k(-8)},pageDown:function(){e!=d.size()-1&&e+8>d.size()?k(d.size()-1-e):k(8)},hide:function(){h&&h.hide();d&&d.removeClass(p.ACTIVE);e=-1},visible:function(){return h&&h.is(":visible")},current:function(){return this.visible()&&(d.filter("."+p.ACTIVE)[0]||a.selectFirst&&d[0])},show:function(){var e=c(b).offset();h.css({width:"string"==
typeof a.width||0<a.width?a.width:c(b).width(),top:e.top+b.offsetHeight,left:e.left}).show();if(a.scroll&&(l.scrollTop(0),l.css({maxHeight:a.scrollHeight,overflow:"auto"}),-1!=navigator.userAgent.indexOf("MSIE")&&"undefined"===typeof document.body.style.maxHeight)){var f=0;d.each(function(){f+=this.offsetHeight});e=f>a.scrollHeight;l.css("height",e?a.scrollHeight:f);e||d.width(l.width()-parseInt(d.css("padding-left"))-parseInt(d.css("padding-right")))}},selected:function(){var a=d&&d.filter("."+p.ACTIVE).removeClass(p.ACTIVE);
return a&&a.length&&c.data(a[0],"ac_data")},emptyList:function(){l&&l.empty()},unbind:function(){h&&h.remove()}}};c.fn.selection=function(a,b){if(void 0!==a)return this.each(function(){if(this.createTextRange){var c=this.createTextRange();void 0===b||a==b?c.move("character",a):(c.collapse(!0),c.moveStart("character",a),c.moveEnd("character",b));c.select()}else this.setSelectionRange?this.setSelectionRange(a,b):this.selectionStart&&(this.selectionStart=a,this.selectionEnd=b)});var c=this[0];if(c.createTextRange){var m=
document.selection.createRange(),q=c.value,k=m.text.length;m.text="<->";m=c.value.indexOf("<->");c.value=q;this.selection(m,m+k);return{start:m,end:m+k}}if(void 0!==c.selectionStart)return{start:c.selectionStart,end:c.selectionEnd}}})(jQuery);
